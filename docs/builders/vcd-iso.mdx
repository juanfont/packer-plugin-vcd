---
description: |
  The vcd-iso builder creates virtual machines on VMware Cloud Director from ISO images.
page_title: VCD ISO - Builders
nav_title: ISO
---

# VMware Cloud Director ISO Builder

Type: `vcd-iso`

The `vcd-iso` builder creates a virtual machine on VMware Cloud Director (VCD), uploads an ISO to a
catalog, installs an operating system using boot commands, provisions software, and exports the
virtual machine as a vApp template.

This builder is ideal for creating golden images from scratch using ISO installation media.

## Basic Example

This example builds a Debian 12 image with automatic IP discovery for static networks:

```hcl
source "vcd-iso" "debian" {
  # VCD Connection
  host                = "vcd.example.com"
  username            = "admin"
  password            = "secret"
  org                 = "my-org"
  vdc                 = "my-vdc"
  insecure_connection = true

  # ISO
  iso_url      = "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.9.0-amd64-netinst.iso"
  iso_checksum = "sha256:..."

  # VM Configuration
  vm_name       = "debian-template"
  vapp          = "packer-build"
  create_vapp   = true
  guest_os_type = "debian12_64Guest"
  CPUs          = 2
  memory        = 2048
  disk_size_mb  = 20480

  # Network - auto-discover IP from network pool
  network            = "my-network"
  ip_allocation_mode = "MANUAL"
  auto_discover_ip   = true

  # HTTP server for preseed
  http_directory = "http"

  # Boot command with network configuration
  boot_wait    = "5s"
  boot_command = [
    "<esc><wait>",
    "auto ",
    "netcfg/disable_autoconfig=true ",
    "netcfg/get_ipaddress={{ .VMIP }} ",
    "netcfg/get_netmask={{ .Netmask }} ",
    "netcfg/get_gateway={{ .Gateway }} ",
    "netcfg/get_nameservers={{ .DNS }} ",
    "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
    "<enter>"
  ]

  # SSH
  ssh_username = "packer"
  ssh_password = "packer"
  ssh_timeout  = "30m"

  # Shutdown
  shutdown_command = "echo packer | sudo -S shutdown -P now"

  # Export to catalog
  export_to_catalog {
    catalog        = "templates"
    template_name  = "debian-12-base"
    create_catalog = true
  }
}

build {
  sources = ["source.vcd-iso.debian"]
}
```

## Configuration Reference

### VCD Connection

@include 'builder/vcd/common/ConnectConfig-not-required.mdx'

### Location

@include 'builder/vcd/common/LocationConfig-not-required.mdx'

### ISO

@include 'packer-plugin-sdk/multistep/commonsteps/ISOConfig-not-required.mdx'

### Catalog

@include 'builder/vcd/common/CatalogConfig-not-required.mdx'

### Hardware

@include 'builder/vcd/common/HardwareConfig-not-required.mdx'

### Boot Command

@include 'builder/vcd/common/BootCommandConfig-not-required.mdx'

### HTTP Directory

@include 'packer-plugin-sdk/multistep/commonsteps/HTTPConfig-not-required.mdx'

### Communicator

#### Common Options

@include 'packer-plugin-sdk/communicator/Config-not-required.mdx'

#### SSH

@include 'packer-plugin-sdk/communicator/SSH-not-required.mdx'

#### WinRM

@include 'packer-plugin-sdk/communicator/WinRM-not-required.mdx'

### Shutdown

@include 'builder/vcd/common/ShutdownConfig-not-required.mdx'

### Export to Catalog

@include 'builder/vcd/common/ExportToCatalogConfig-not-required.mdx'

## Network Considerations

For ISO-based builds with preseed/kickstart, the VM needs network connectivity to fetch the preseed
file from the Packer HTTP server during OS installation.

### DHCP Networks

If your VCD network has DHCP enabled, the installer will automatically obtain an IP address and can
fetch the preseed file without additional configuration:

```hcl
ip_allocation_mode = "DHCP"

boot_command = [
  "auto url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg<enter>"
]
```

### Static IP Networks

If your VCD network uses IP pools without DHCP, you can use automatic IP discovery or specify the
IP manually.

#### Auto-discover IP (Recommended)

Enable `auto_discover_ip` to automatically find an available IP from the network's pool:

```hcl
ip_allocation_mode = "MANUAL"
auto_discover_ip   = true

boot_command = [
  "<esc>auto ",
  "netcfg/disable_autoconfig=true ",
  "netcfg/get_ipaddress={{ .VMIP }} ",
  "netcfg/get_netmask={{ .Netmask }} ",
  "netcfg/get_gateway={{ .Gateway }} ",
  "netcfg/get_nameservers={{ .DNS }} ",
  "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg<enter>"
]
```

You can override the discovered gateway and DNS if needed:

```hcl
auto_discover_ip = true
vm_gateway       = "10.0.0.1"
vm_dns           = "8.8.8.8"
```

#### Manual IP

Alternatively, specify the IP address manually. When `vm_ip` is set, template variables `{{ .VMIP }}`,
`{{ .Gateway }}`, etc. are not available - use hardcoded values:

```hcl
ip_allocation_mode = "MANUAL"
vm_ip              = "10.0.0.100"

boot_command = [
  "<esc><wait>",
  "auto ",
  "netcfg/disable_autoconfig=true ",
  "netcfg/get_ipaddress=10.0.0.100 ",
  "netcfg/get_netmask=255.255.255.0 ",
  "netcfg/get_gateway=10.0.0.1 ",
  "netcfg/get_nameservers=10.0.0.1 ",
  "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
  "<enter>"
]
```

## Boot Command

The boot command is sent to the VM console via the WebMKS protocol. It supports standard Packer
boot command syntax:

- `<enter>`, `<return>` - Enter key
- `<esc>` - Escape key
- `<tab>` - Tab key
- `<f1>` through `<f12>` - Function keys
- `<wait>`, `<wait5>`, `<wait10>` - Wait for 1, 5, or 10 seconds
- `<waitXs>`, `<waitXm>` - Wait for X seconds or minutes

Template variables available:

- `{{ .HTTPIP }}` - IP address of the HTTP server
- `{{ .HTTPPort }}` - Port of the HTTP server
- `{{ .Name }}` - VM name
- `{{ .VMIP }}` - VM IP address (when `auto_discover_ip` is enabled or `vm_ip` is set)
- `{{ .Gateway }}` - Network gateway (when `auto_discover_ip` is enabled)
- `{{ .Netmask }}` - Network mask (when `auto_discover_ip` is enabled)
- `{{ .DNS }}` - DNS server (when `auto_discover_ip` is enabled)

## Windows Builds

For Windows builds, use the WinRM communicator:

```hcl
source "vcd-iso" "windows" {
  # ... VCD and VM configuration ...

  communicator   = "winrm"
  winrm_username = "Administrator"
  winrm_password = "YourPassword"
  winrm_timeout  = "2h"
}
```

Your `autounattend.xml` must enable WinRM:

```xml
<SynchronousCommand>
  <CommandLine>winrm quickconfig -q</CommandLine>
</SynchronousCommand>
<SynchronousCommand>
  <CommandLine>winrm set winrm/config/service @{AllowUnencrypted="true"}</CommandLine>
</SynchronousCommand>
<SynchronousCommand>
  <CommandLine>winrm set winrm/config/service/auth @{Basic="true"}</CommandLine>
</SynchronousCommand>
```
